{
  "hash": "fe9180e4a6c5ffc8da1e2698a31bf680",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 3: Provincial Competitiveness Index in Vietnam\"\nauthor: \"kai feng\"\ndate: \"Oct 15, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  freeze: true\n---\n\n\n# **Introduction**\n\n## Provincial Competitiveness Index in Vietnam\n\n**Context**: Vietnam's provinces exhibit varying levels of competitiveness, as captured by the **Provincial Competitiveness Index (PCI)**. This index evaluates critical dimensions that influence the investment climate and economic potential of each region.\n\n**Challenges**: As different provinces seek to enhance their attractiveness for investment and business development, they face challenges related to **regional disparities** and the effectiveness of governance and infrastructure. Understanding the specific dimensions of PCI is essential for identifying competitive advantages and areas for improvement.\n\n## Key Trends\n\n-   **Dimension Variation**: Provinces demonstrate diverse strengths and weaknesses across key PCI dimensions, such as **entry costs**, **land access**, **transparency**, **productivity**, and **labor training**. These variations directly impact the suitability of each province for different sectors.\n\n-   **Sectoral Suitability**: The capacity of provinces to support various industries is influenced by the effectiveness of local policies and resources, which can lead to uneven development across sectors.\n\n## This Geospatial Analysis Will Focus on\n\n**Objectives**: The primary aim of this analysis is to evaluate the individual dimensions of the **Provincial Competitiveness Index (PCI)** to assess their impact on the suitability of provinces for specific sectors, such as **manufacturing**, **services**, or **technology**.\n\n## Analysis Goals\n\n-   **Dimension-Specific Clustering**: Utilize **Local Indicators of Spatial Association (LISA)** to explore how specific PCI dimensions contribute to clustering patterns, identifying which provinces excel in particular areas and why.\n\n-   **Sectoral Recommendations**: Assess which provinces are best suited for specific industries based on their strengths in key PCI dimensions, offering insights into potential investment opportunities.\n\n-   **Future Projections**: Apply predictive modeling techniques, including the **Mandell model**, to forecast trends in PCI dimensions over the coming years, providing insights into how these trends may influence sectoral suitability and competitiveness.\n\n## Significance\n\nThis project aims to provide a detailed analysis of how the **dimensions of the Provincial Competitiveness Index** shape the economic landscape of Vietnam. By focusing on specific PCI elements and their implications for sectoral suitability, this study will offer actionable insights for policymakers and businesses seeking to navigate Vietnam's diverse economic environment.\n\n<br/><br/>\n\n# **1.0 Setup**\n\n## 1.1 Installing R-Packages\n\n::: panel-tabset\n## *Importing and Transforming Data*\n\n-   `sf`:\n\n    -   For handling spatial vector data and transforming it into simple features (`sf`) objects.\n\n    -   Functions like `st_read()` for importing spatial data and `st_transform()` for coordinate reference system transformations.\n\n-   `tidyverse`: For data manipulation and transformation, including functions for working with `tibble` data frames.\n\n-   `readr`: For reading in CSV or other text-based data files if needed.\n\n-   `dplyr`: provide data manipulation capabilities (eg. to group and summarize the relationships between these columns)\n\n## *Displaying Maps*\n\n-   `tmap`: For creating thematic maps\n\n-   `ggplot2`: For additional custom visualizations if needed.\n\n-   *`scales`*: Transform the unit of measurement for coordinate\n\n-   `animation, png, magick`: For animation work\n\n## *Spatial Autocorrelation*\n\n-   `sfdep`: For performing both local and global spatial autocorrelation analysis\n\n## *Trend Analysis*\n\n-   `Kendall`\n\n## *Prediction*\n\n-   `forecast`: For trend prediction\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sf, readr, ggplot2, tmap, dplyr, animation, png, magick, openxlsx, readxl, sfdep, Kendall, forecast)\n```\n:::\n\n\n<br/>\n\n## 1.2 Data Acquisition\n\nWe will be using these dataset:\n\n::: panel-tabset\n## Administrative Boundaries\n\n-   **Source:** [Vietnam - Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-vnm?) at HDX.\n-   **Province Boundaries**: To map scores from various analyses onto geographic boundaries, enabling visualization of regional competitiveness patterns across the country\n\n## General Data\n\n-   **Source:** [[Vietnam Statistics Office]{.underline}](https://www.gso.gov.vn/en/homepage/) , [Provincial Competitiveness Index](https://pcivietnam.vn/en)\n\n-   **Provincial Competitiveness Index (PCI):** To evaluate the competitive environment of each province, identifying strengths and weaknesses that influence investment potential.\n\n-   **Foreign Direct Investment (FDI):** To assess the attractiveness of provinces for foreign investors and identify trends in investment across different sectors.\n\n-   **Gross Domestic Product (GDP):** Provide insights into the economic performance of each province, allowing for comparisons with PCI dimensions and investment trends.\n\n-   **Industrial Production:** Analyzed to determine the output levels of various industries, revealing which sectors are thriving in relation to provincial competitiveness.\n:::\n\n<br/>\n\n## 1.3 Data Preparation and Wrangling\n\n::: panel-tabset\n## Administrative Boundaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprovincial_boundaries <- st_read(dsn = \"data/boundaries/provincial\", layer=\"geoBoundaries-VNM-ADM1\")\nclass(provincial_boundaries)\nst_crs(provincial_boundaries)\n\nprovincial_boundaries <- provincial_boundaries %>%\n  st_transform(crs = 3405) # Transform coordinate\n\n# Drop & Rename column\nprovincial_boundaries <- provincial_boundaries %>% \n  select(shapeName, shapeISO, shapeGroup, geometry) %>% \n  rename(\n    province_vn = shapeName,\n    province_code = shapeISO,\n    country_code = shapeGroup\n  )\n\n# Create a new column 'province_en' based on 'province_code'\nprovincial_boundaries <- provincial_boundaries %>%\n  mutate(province_en = case_when(\n    province_code == \"VN-44\" ~ \"An Giang\",\n    province_code == \"VN-43\" ~ \"BRVT\",\n    province_code == \"VN-54\" ~ \"Bac Giang\",\n    province_code == \"VN-53\" ~ \"Bac Kan\",\n    province_code == \"VN-55\" ~ \"Bac Lieu\",\n    province_code == \"VN-56\" ~ \"Bac Ninh\",\n    province_code == \"VN-50\" ~ \"Ben Tre\",\n    province_code == \"VN-31\" ~ \"Binh Dinh\",\n    province_code == \"VN-57\" ~ \"Binh Duong\",\n    province_code == \"VN-58\" ~ \"Binh Phuoc\",\n    province_code == \"VN-40\" ~ \"Binh Thuan\",\n    province_code == \"VN-59\" ~ \"Ca Mau\",\n    province_code == \"VN-CT\" ~ \"Can Tho\",\n    province_code == \"VN-04\" ~ \"Cao Bang\",\n    province_code == \"VN-DN\" ~ \"Da Nang\",\n    province_code == \"VN-33\" ~ \"Dak Lak\",\n    province_code == \"VN-72\" ~ \"Dak Nong\",\n    province_code == \"VN-71\" ~ \"Dien Bien\",\n    province_code == \"VN-39\" ~ \"Dong Nai\",\n    province_code == \"VN-45\" ~ \"Dong Thap\",\n    province_code == \"VN-30\" ~ \"Gia Lai\",\n    province_code == \"VN-SG\" ~ \"HCMC\",\n    province_code == \"VN-03\" ~ \"Ha Giang\",\n    province_code == \"VN-63\" ~ \"Ha Nam\",\n    province_code == \"VN-HN\" ~ \"Ha Noi\",\n    province_code == \"VN-23\" ~ \"Ha Tinh\",\n    province_code == \"VN-61\" ~ \"Hai Duong\",\n    province_code == \"VN-HP\" ~ \"Hai Phong\",\n    province_code == \"VN-73\" ~ \"Hau Giang\",\n    province_code == \"VN-14\" ~ \"Hoa Binh\",\n    province_code == \"VN-66\" ~ \"Hung Yen\",\n    province_code == \"VN-34\" ~ \"Khanh Hoa\",\n    province_code == \"VN-47\" ~ \"Kien Giang\",\n    province_code == \"VN-28\" ~ \"Kon Tum\",\n    province_code == \"VN-01\" ~ \"Lai Chau\",\n    province_code == \"VN-35\" ~ \"Lam Dong\",\n    province_code == \"VN-09\" ~ \"Lang Son\",\n    province_code == \"VN-02\" ~ \"Lao Cai\",\n    province_code == \"VN-41\" ~ \"Long An\",\n    province_code == \"VN-67\" ~ \"Nam Dinh\",\n    province_code == \"VN-22\" ~ \"Nghe An\",\n    province_code == \"VN-18\" ~ \"Ninh Binh\",\n    province_code == \"VN-36\" ~ \"Ninh Thuan\",\n    province_code == \"VN-68\" ~ \"Phu Tho\",\n    province_code == \"VN-32\" ~ \"Phu Yen\",\n    province_code == \"VN-24\" ~ \"Quang Binh\",\n    province_code == \"VN-27\" ~ \"Quang Nam\",\n    province_code == \"VN-29\" ~ \"Quang Ngai\",\n    province_code == \"VN-13\" ~ \"Quang Ninh\",\n    province_code == \"VN-25\" ~ \"Quang Tri\",\n    province_code == \"VN-52\" ~ \"Soc Trang\",\n    province_code == \"VN-05\" ~ \"Son La\",\n    province_code == \"VN-26\" ~ \"TT-Hue\",\n    province_code == \"VN-37\" ~ \"Tay Ninh\",\n    province_code == \"VN-20\" ~ \"Thai Binh\",\n    province_code == \"VN-69\" ~ \"Thai Nguyen\",\n    province_code == \"VN-21\" ~ \"Thanh Hoa\",\n    province_code == \"VN-46\" ~ \"Tien Giang\",\n    province_code == \"VN-51\" ~ \"Tra Vinh\",\n    province_code == \"VN-07\" ~ \"Tuyen Quang\",\n    province_code == \"VN-49\" ~ \"Vinh Long\",\n    province_code == \"VN-70\" ~ \"Vinh Phuc\",\n    province_code == \"VN-06\" ~ \"Yen Bai\"\n  )) %>% \n  select (province_en, everything())\n\nwrite_rds(provincial_boundaries, \"data/rds/provincial_boundaries.rds\")\n```\n:::\n\n\n::: callout-note\nSince Coordinate Reference System of **provincial_boundaries**\n\nis in 4326 (unit of measurement = degree), we have to transform it\n\nAlso, we need to have an english name for each province to allow us to map the province boundary with other dataset\n:::\n\n## General Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\npci_2012 <- read_xlsx(\"data/provincial_competitiveness_index/2012.xlsx\")\npci_2013 <- read_xlsx(\"data/provincial_competitiveness_index/2013.xlsx\")\npci_2014 <- read_xlsx(\"data/provincial_competitiveness_index/2014.xlsx\")\npci_2015 <- read_xlsx(\"data/provincial_competitiveness_index/2015.xlsx\")\npci_2016 <- read_xlsx(\"data/provincial_competitiveness_index/2016.xlsx\")\npci_2017 <- read_xlsx(\"data/provincial_competitiveness_index/2017.xlsx\")\npci_2018 <- read_xlsx(\"data/provincial_competitiveness_index/2018.xlsx\")\npci_2019 <- read_xlsx(\"data/provincial_competitiveness_index/2019.xlsx\")\npci_2020 <- read_xlsx(\"data/provincial_competitiveness_index/2020.xlsx\")\npci_2021 <- read_xlsx(\"data/provincial_competitiveness_index/2021.xlsx\")\npci_2022 <- read_xlsx(\"data/provincial_competitiveness_index/2022.xlsx\")\n\n# Combine all datasets with the year column and move year to the front\npci_combined <- bind_rows(\n  mutate(pci_2012, year = 2012),\n  mutate(pci_2013, year = 2013),\n  mutate(pci_2014, year = 2014),\n  mutate(pci_2015, year = 2015),\n  mutate(pci_2016, year = 2016),\n  mutate(pci_2017, year = 2017),\n  mutate(pci_2018, year = 2018),\n  mutate(pci_2019, year = 2019),\n  mutate(pci_2020, year = 2020),\n  mutate(pci_2021, year = 2021),\n  mutate(pci_2022, year = 2022)\n) %>%\n    left_join(select(pci_2022, province_en, Region), by = \"province_en\") %>%\n  select (1:13, 15) %>% \n  rename(region = Region.y) %>% \n  select(year, region, everything())\n\nwrite.xlsx(pci_combined, \"data/rds/combined_pci.xlsx\")\n\nagri_sector <- pci_combined %>% \n  left_join(provincial_boundaries, by = \"province_en\") %>% \n  mutate(\n    weighted_score = `Land Access` * 0.30 + \n                     `Law & Order` * 0.25 + \n                     `Labor Policy` * 0.20 + \n                     `Business Support Policy` * 0.15 + \n                     `Entry Costs` * 0.10\n  ) %>%\n  select(province_en, year, weighted_score, geometry)\n\nwrite_rds(agri_sector, \"data/rds/agri_sector.rds\")\n\n\nindustry_construction_sector <- pci_combined %>% \n  left_join(provincial_boundaries, by = \"province_en\") %>% \n  mutate(\n    weighted_score = `Labor Policy` * 0.30 + \n                     `Land Access` * 0.25 + \n                     `Entry Costs` * 0.20 + \n                     `Business Support Policy` * 0.15 + \n                     Transparency * 0.10\n  ) %>%\n  select(province_en, year, weighted_score, geometry)\n\nwrite_rds(industry_construction_sector, \"data/rds/industry_construction_sector.rds\")\n\nservices_sector <- pci_combined %>% \n  left_join(provincial_boundaries, by = \"province_en\") %>% \n  mutate(\n    weighted_score = Transparency * 0.30 + \n                     `Business Support Policy` * 0.25 + \n                     `Labor Policy` * 0.20 + \n                     `Entry Costs` * 0.15 + \n                     Proactivity * 0.10\n  ) %>%\n  select(province_en, year, weighted_score, geometry)\n\nwrite_rds(services_sector, \"data/rds/services_sector.rds\")\n```\n:::\n\n\n::: callout-note\nSome datasets were inconsistent, so I created a new sheet called 'summary' and renamed the old one to 'summary - old'. The new sheet uses the XLOOKUP function for quick data population from the old sheet, which is much faster compared to handling it in R. In R, different sets of code would be required to manage various data types, making the process more time-consuming.\n\nFor economy_pie dataset, we have also performed simple data reformatting shown in 'Summary' sheet from 'Summary -old' sheet\n:::\n:::\n\n<br/><br/>\n\n# **2.0 Importing the clean set of data**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprovincial_boundaries <- read_rds(\"data/rds/provincial_boundaries.rds\")\n\neconomy_pie <- read_xlsx(\"data/economy_pie.xlsx\")\n\npci_combined <- read_xlsx(\"data/rds/combined_pci.xlsx\")\n\nagri_sector <- read_rds(\"data/rds/agri_sector.rds\")\n\nindustry_construction_sector <- read_rds(\"data/rds/industry_construction_sector.rds\")\n\nservices_sector <- read_rds(\"data/rds/services_sector.rds\")\n```\n:::\n\n\n<br/><br/>\n\n# **3.0 Exploratory Data Analysis**\n\n## Key backbone industries Performance\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean and ensure the percentage columns are numeric\ndata <- economy_pie %>%\n  mutate(\n    agriculture_forestry_fishing = as.numeric(gsub(\"[^0-9.]\", \"\", `Agriculture, forestry and fishing (%)`)),\n    industry_construction = as.numeric(gsub(\"[^0-9.]\", \"\", `Industry and construction (%)`)),\n    service = as.numeric(gsub(\"[^0-9.]\", \"\", `Service (%)`)),\n  )\n\n# Convert wide format to long format for easier analysis\ndata_long <- data %>%\n  pivot_longer(cols = c(agriculture_forestry_fishing, industry_construction, service), \n               names_to = \"industry\", \n               values_to = \"percent\")\n\n# Calculate yearly percentage change for each sector\ndata_long <- data_long %>%\n  group_by(industry) %>%\n  arrange(year) %>%\n  mutate(percent_change = (percent - lag(percent)) / lag(percent) * 100) %>%\n  ungroup()\n\n# Identify the sector with the highest average growth\nupcoming_sector <- data_long %>%\n  group_by(industry) %>%\n  summarise(avg_percent_change = mean(percent_change, na.rm = TRUE)) %>%\n  arrange(desc(avg_percent_change))\n\n# Print the sector with the highest average percentage increase\nprint(upcoming_sector)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  industry                     avg_percent_change\n  <chr>                                     <dbl>\n1 industry_construction                     0.642\n2 service                                   0.563\n3 agriculture_forestry_fishing             -2.88 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Plot the trend for each sector\nggplot(data_long, aes(x = year, y = percent, color = industry, group = industry)) +\n  geom_line() +\n  geom_point() +\n  labs(title = \"Sector Percentage Contribution Over Time\",\n       x = \"Year\", y = \"Percentage (%)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n::: callout-note\nThe agriculture, forestry, and fishing sector is experiencing a downward trend, with a -2.88% change. In contrast, the industry, construction, and service sectors are on the rise, with increases of 0.64% and 0.56%, respectively.\n\nIt's important to carefully consider your investment choices, as the industry, construction, and service sectors are emerging as promising areas for growth.\n:::\n\n<br/><br/>\n\n# **4.0 Provinces suitable for Agriculture, Forestry and Fishing sector**\n\n## Importance Scorecard\n\nWe will initially utilize an importance scorecard to identify the key factors that facilitate investment in the Agriculture, Forestry, and Fishing sector. Each factor will be assigned a weight based on its significance in influencing investment decisions.\n\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Factors                 | Weightage | Remarks                                                                                                                                                                                                                                    |\n+=========================+===========+============================================================================================================================================================================================================================================+\n| Land Access             | 30        | Efficient use of land is a significant factor, particularly in Vietnam, where land reforms and policies directly impact productivity.                                                                                                      |\n|                         |           |                                                                                                                                                                                                                                            |\n|                         |           | Sustainable land management and allocation are crucial to achieving long-term growth in this sector​                                                                                                                                        |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Law & Order             | 25        | Law enforcement to protect property rights and ensure compliance with environmental and labor standards is increasingly important​                                                                                                          |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Labor Policy            | 20        | Labor costs, which are rising, and the need for skilled labor are critical in making agriculture more knowledge-based and innovative                                                                                                       |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Business Support Policy | 15        | Supporting policies for agribusiness development, particularly in adding value and driving sustainability through innovation, are essential. The government's role in facilitating this transformation with proactive policies is critical​ |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Entry Costs             | 10        | Reducing barriers for smaller or new businesses in agriculture can help foster innovation and inclusivity in the sector                                                                                                                    |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n<br/>\n\n## Local Indicator of Spatial Association (LISA)\n\nThe application of Local Indicators of Spatial Association (LISA) in this analysis is intended to investigate the spatial dynamics of the agricultural sector across multiple years.\n\nBy conducting LISA for each individual year, this analysis seeks to identify local patterns of correlation that reveal significant clusters of high and low agricultural performance over time.\n\nSuch a year-by-year assessment provides critical insights into the fluctuations of agricultural metrics across different provinces, allowing for a thorough evaluation of the spatial relationships inherent in the sector.\n\n::: panel-tabset\n## 2012\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2012.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-6-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2012 <- agri_sector %>% \n  filter(year == 2012)\n  \n\nagri_sector_2012 <- st_as_sf(agri_sector_2012)\nnb <- st_contiguity(agri_sector_2012$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2012 <- agri_sector_2012 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2012 <- agri_sector_2012 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2012.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2012 <- lisa_agri_sector_2012  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2012) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2012) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2012\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2013\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2013.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-10-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2013 <- agri_sector %>% \n  filter(year == 2013)\n  \n\nagri_sector_2013 <- st_as_sf(agri_sector_2013)\nnb <- st_contiguity(agri_sector_2013$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2013 <- agri_sector_2013 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2013 <- agri_sector_2013 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2013.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2013 <- lisa_agri_sector_2013  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2013) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2013) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2013\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2014\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2014.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-14-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2014 <- agri_sector %>% \n  filter(year == 2014) \n  \n\nagri_sector_2014 <- st_as_sf(agri_sector_2014)\nnb <- st_contiguity(agri_sector_2014$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2014 <- agri_sector_2014 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2014 <- agri_sector_2014 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2014.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2014 <- lisa_agri_sector_2014  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2014) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2014) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2014\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2015\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2015.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-18-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2015 <- agri_sector %>% \n  filter(year == 2015) \n  \n\nagri_sector_2015 <- st_as_sf(agri_sector_2015)\nnb <- st_contiguity(agri_sector_2015$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2015 <- agri_sector_2015 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2015 <- agri_sector_2015 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2015.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2015 <- lisa_agri_sector_2015  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2015) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2015) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2015\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2016\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2016.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-22-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2016 <- agri_sector %>% \n  filter(year == 2016) \n  \n\nagri_sector_2016 <- st_as_sf(agri_sector_2016)\nnb <- st_contiguity(agri_sector_2016$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2016 <- agri_sector_2016 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2016 <- agri_sector_2016 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2016.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2016 <- lisa_agri_sector_2016  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2016) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2016) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2016\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2017.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-26-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2017 <- agri_sector %>% \n  filter(year == 2017) \n  \n\nagri_sector_2017 <- st_as_sf(agri_sector_2017)\nnb <- st_contiguity(agri_sector_2017$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2017 <- agri_sector_2017 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2017 <- agri_sector_2017 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2017.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2017 <- lisa_agri_sector_2017  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2017) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2017) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2017\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2018\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2018.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-30-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2018 <- agri_sector %>% \n  filter(year == 2018) \n  \n\nagri_sector_2018 <- st_as_sf(agri_sector_2018)\nnb <- st_contiguity(agri_sector_2018$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2018 <- agri_sector_2018 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2018 <- agri_sector_2018 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2018.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2018 <- lisa_agri_sector_2018  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2018) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2018) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2018\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2019\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2019.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-34-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2019 <- agri_sector %>% \n  filter(year == 2019) \n  \n\nagri_sector_2019 <- st_as_sf(agri_sector_2019)\nnb <- st_contiguity(agri_sector_2019$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2019 <- agri_sector_2019 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2019 <- agri_sector_2019 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2019.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2019 <- lisa_agri_sector_2019  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2019) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2019) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2019\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2020.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-38-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2020 <- agri_sector %>% \n  filter(year == 2020) \n  \n\nagri_sector_2020 <- st_as_sf(agri_sector_2020)\nnb <- st_contiguity(agri_sector_2020$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2020 <- agri_sector_2020 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2020 <- agri_sector_2020 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2020.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2020 <- lisa_agri_sector_2020  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2020) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2020) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2020\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2021\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2021.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-42-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2021 <- agri_sector %>% \n  filter(year == 2021) \n  \n\nagri_sector_2021 <- st_as_sf(agri_sector_2021)\nnb <- st_contiguity(agri_sector_2021$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2021 <- agri_sector_2021 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2021 <- agri_sector_2021 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2021.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2021 <- lisa_agri_sector_2021  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2021) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2021) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2021\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/lisa_map_2022.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-46-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector_2022 <- agri_sector %>% \n  filter(year == 2022) \n  \n\nagri_sector_2022 <- st_as_sf(agri_sector_2022)\nnb <- st_contiguity(agri_sector_2022$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector_2022 <- agri_sector_2022 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_agri_sector_2022 <- agri_sector_2022 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/lisa_map_2022.png\", width = 1600, height = 1200)\n\nlisa__agri_sector_sig_2022 <- lisa_agri_sector_2022  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_agri_sector_2022) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__agri_sector_sig_2022) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2022\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n:::\n\n<br/>\n\n## Hot Spot & Cold Spot Area Analysis (HCSA)\n\nSubsequent to the LISA analysis, a Hotspot and Coldspot Analysis (HCSA) will be conducted to evaluate the temporal trends in agricultural performance over the same time frame.\n\nHCSA is instrumental in identifying areas that have exhibited consistent patterns of improvement or decline over the years. Through the assessment of the evolution of hot and cold spots, this analysis will highlight emerging investment opportunities while also identifying regions that require targeted interventions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-50-1.png){width=800}\n:::\n:::\n\n\n::: panel-tabset\n## Computing local Gi\\* statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagri_sector <- st_as_sf(agri_sector)\nnb <- st_contiguity(agri_sector$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nagri_sector <- agri_sector %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n\n\nhcsa <- agri_sector %>% \n  mutate(local_Gi = local_gstar_perm(\n    weighted_score, nb, wts, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi)\n```\n:::\n\n\n## Visualising Hot Spot & Cold Spot\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/hcsa_map.png\", width = 1600, height = 1200)\n\nHCSA_sig <- hcsa  %>%\n  filter(p_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(hcsa) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(HCSA_sig) +\n  tm_fill(\"cluster\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## HCSA Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhcsa_summary <- read_rds(\"data/rds/agri_sector/hcsa_summary.rds\")\n# Show all rows and columns\nprint(hcsa_summary, n = Inf, width = Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 10 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 205950.8 ymin: 933052.3 xmax: 1597017 ymax: 2586945\nProjected CRS: VN-2000 / UTM zone 48N\n# A tibble: 1 × 11\n  mean_gi_star min_gi_star max_gi_star sd_gi_star mean_p_value min_p_value\n         <dbl>       <dbl>       <dbl>      <dbl>        <dbl>       <dbl>\n1      -0.0406       -4.74        4.04       2.02        0.307 0.000000180\n  max_p_value count_hot_spots count_cold_spots count_non_significant\n        <dbl>           <int>            <int>                 <int>\n1       0.999             128              126                   450\n                                                                        geometry\n                                                              <MULTIPOLYGON [m]>\n1 (((481707.8 934784, 481390.2 933367, 480954.2 933052.3, 480280.8 933564.3, 47…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to summarize HCSA values\nsummarize_hcsa <- function(data) {\n  data %>%\n    summarise(\n      mean_gi_star = mean(gi_star, na.rm = TRUE),\n      min_gi_star = min(gi_star, na.rm = TRUE),\n      max_gi_star = max(gi_star, na.rm = TRUE),\n      sd_gi_star = sd(gi_star, na.rm = TRUE),\n      mean_p_value = mean(p_value, na.rm = TRUE),\n      min_p_value = min(p_value, na.rm = TRUE),\n      max_p_value = max(p_value, na.rm = TRUE),\n      count_hot_spots = sum(gi_star > 0 & p_value < 0.05),\n      count_cold_spots = sum(gi_star < 0 & p_value < 0.05),\n      count_non_significant = sum(p_value >= 0.05),\n      geometry = st_union(geometry)  # Combine geometries\n    )\n}\n\n\nhcsa_summary <- summarize_hcsa(hcsa)\nwrite_rds(hcsa_summary, \"data/rds/agri_sector/hcsa_summary.rds\")\n```\n:::\n\n:::\n\n::: callout-note\n## HCSA Summary Interpretation\n\n### **Mean `gi_star`: -0.0405665**\n\n-   The average local spatial autocorrelation is slightly negative, suggesting that, on average, regions with lower agricultural competitiveness tend to cluster together (cold spots). This could indicate areas that are struggling in the agricultural sector.\n\n### **Standard Deviation (`sd_gi_star`): 2.018674**\n\n-   **Interpretation**: A relatively high standard deviation indicates considerable variation in agricultural competitiveness across regions. This suggests that while some areas excel, others may significantly lag, pointing to disparities in agricultural practices or resources.\n\n### **Mean `p_value`: 0.3060628**\n\n-   The average p-value suggests that, overall, many regions do not show statistically significant clustering of agricultural competitiveness. However, the mean being above 0.05 indicates that a significant portion of the regions might not exhibit consistent spatial patterns of high or low competitiveness.\n:::\n\n<br/>\n\n## Mann-Kendall Test for trend\n\nThis will evaluate the competitiveness trends of the Agriculture, Forestry, and Fishing sectors across each province over multiple years.\n\nThe goal is to identify provinces that are becoming more competitive as well as those that are experiencing a decline in competitiveness.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrend_results <- read_rds(\"data/rds/agri_sector/trend_results.rds\")\n```\n:::\n\n\n::: panel-tabset\n## Increasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasing_trends <- trend_results %>%\n  filter(trend_status == \"Increasing\") %>%\n  pull(province_en)\n\n# Check if increasing_trends is null or empty and set a default message\nif (is.null(increasing_trends) || length(increasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(increasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAn Giang, BRVT, Bac Giang, Bac Kan, Bac Ninh, Ben Tre, Binh Dinh, Binh Duong, Binh Phuoc, Binh Thuan, Ca Mau, Can Tho, Cao Bang, Dak Lak, Dak Nong, Dien Bien, Dong Nai, Dong Thap, Gia Lai, HCMC, Ha Giang, Ha Noi, Ha Tinh, Hai Duong, Hai Phong, Hoa Binh, Hung Yen, Khanh Hoa, Kon Tum, Lam Dong, Lang Son, Lao Cai, Long An, Nam Dinh, Nghe An, Ninh Binh, Ninh Thuan, Phu Tho, Phu Yen, Quang Nam, Quang Ninh, Quang Tri, Soc Trang, Son La, TT-Hue, Thai Binh, Thai Nguyen, Thanh Hoa, Tuyen Quang, Vinh Long, Vinh Phuc, Yen Bai \n```\n\n\n:::\n:::\n\n\n## Decreasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndecreasing_trends <- trend_results %>%\n  filter(trend_status == \"Decreasing\") %>%\n  pull(province_en)\n\n# Check if decreasing_trends is null or empty and set a default message\nif (is.null(decreasing_trends) || length(decreasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(decreasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNIL \n```\n\n\n:::\n:::\n\n\n## Stable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstable_trends <- trend_results %>%\n  filter(trend_status == \"Stable\") %>%\n  pull(province_en)\n\n# Check if stable_trends is null or empty and set a default message\nif (is.null(stable_trends) || length(stable_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(stable_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBac Lieu, Da Nang, Ha Nam, Hau Giang, Kien Giang, Lai Chau, Quang Binh, Quang Ngai, Tay Ninh, Tien Giang, Tra Vinh \n```\n\n\n:::\n:::\n\n:::\n\n::: callout-note\nThe majority of provinces are experiencing increasing trends in competitiveness, with only a few remaining relatively stable and notably none showing a decline. These findings indicate a largely positive outlook for the Agriculture, Forestry, and Fishing sectors, presenting significant investment opportunities for growth and development.\n\nHowever, it is important to consider that, **despite the rising competitiveness**, the **GDP contribution from this sector** has been **shrinking** over the years, even as the total GDP for all three sectors continues to increase. This trend suggests a need for strategic investment that not only focuses on enhancing competitiveness but also aims to reverse the decline in GDP share.\n\nInvestors can capitalize on the upward trajectory of competitiveness by targeting provinces that show strong potential for profitable ventures. Additionally, policymakers and stakeholders can leverage this information to attract investment by strengthening competitive strategies in stable provinces. By building on existing strengths and addressing potential challenges, these sectors can enhance their appeal to investors and work towards revitalizing their GDP contributions, ultimately driving sustainable growth and innovation.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Apply Mann-Kendall Test for each province\ntrend_results <- agri_sector %>%\n  group_by(province_en) %>%\n  summarise(\n    weighted_score = list(weighted_score),         \n    trend = MannKendall(unlist(weighted_score))$tau,  # Tau value indicates trend direction\n    p_value = MannKendall(unlist(weighted_score))$sl,   # p-value for significance\n  )\n\n# Classify trends based on the Mann-Kendall results\ntrend_results <- trend_results %>%\n  mutate(trend_status = case_when(\n    p_value < 0.05 & trend > 0 ~ \"Increasing\",\n    p_value < 0.05 & trend < 0 ~ \"Decreasing\",\n    p_value >= 0.05 ~ \"Stable\",\n    TRUE ~ \"No sufficient data\"\n  ))\n\nwrite_rds(trend_results, \"data/rds/agri_sector/trend_results.rds\")\n```\n:::\n\n\n<br/>\n\n## Dendrogram Analysis to Identify Competitiveness Clusters\n\nIt visually clusters provinces with similar trends in weighted scores across years. By grouping provinces based on competitiveness factors, it highlights regions with shared strengths or challenges, allowing stakeholders to identify investment-friendly clusters or regions needing targeted support.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naverage_scores <- agri_sector %>%\n  group_by(province_en) %>%\n  summarise(avg_weighted_score = mean(weighted_score, na.rm = TRUE)) %>%\n  ungroup()\n\n# Convert province_en to row names\naverage_scores_rownames <- average_scores %>%\n  column_to_rownames(var = \"province_en\")\n\nproxmat <- dist(average_scores_rownames, method = 'euclidean')\nhclust_ward <- hclust(proxmat, method = 'ward.D')\ngroups <- as.factor(cutree(hclust_ward, k=6))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(hclust_ward, cex=0.6)\nrect.hclust(hclust_ward, k=6, border=2.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-61-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n<br/>\n\n## Forecasting Near-Term Provincial Competitiveness\n\nThis foresight enables investors and decision-makers to proactively anticipate challenges and seize opportunities, allowing them to respond swiftly and effectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/agri_sector/prediction_hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-63-1.png){width=800}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narima_forecasts <- list()\n\nfor (province in unique(agri_sector$province_en)) {\n  province_data <- agri_sector %>%\n    filter(province_en == province) %>%\n    arrange(year)\n  \n  # Create time series object for weighted score\n  ts_data <- ts(province_data$weighted_score, start = min(province_data$year), frequency = 1)\n  \n  # Fit ARIMA model\n  fit <- auto.arima(ts_data)\n  \n  # Forecast for the next 5 years (2023 to 2027)\n  forecasted_values <- forecast(fit, h = 5)\n  \n  # Store forecast results for each year\n  arima_forecasts[[province]] <- data.frame(\n    province_en = province,\n    year = 2023:2027,\n    predicted_weighted_score = as.numeric(forecasted_values$mean)\n  )\n}\n\n# Combine forecast results for all provinces\nfuture_predictions <- bind_rows(arima_forecasts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set thresholds for hot and cold spots\nhot_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.75)\ncold_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.25)\n\n# Classify hot/cold spots based on predicted cases for each year\nfuture_predictions <- future_predictions %>%\n  mutate(hot_cold_label = case_when(\n    predicted_weighted_score > hot_spot_threshold ~ \"Hot Spot\",\n    predicted_weighted_score < cold_spot_threshold ~ \"Cold Spot\",\n    TRUE ~ \"Neutral\"\n  ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/agri_sector/prediction_hcsa_map.png\", width = 1600, height = 1200)\n\n# Merge predictions with spatial data\nfuture_spatial <- provincial_boundaries %>%\n  left_join(future_predictions, by = \"province_en\")\n\n\ntm_shape(future_spatial) +\n  tm_polygons(\"hot_cold_label\", palette = c(\"blue\", \"red\", \"gray\")) +\n  tm_borders() +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n<br/><br/>\n\n# **5.0 Provinces suitable for Industry and Construction sector**\n\n## Importance Scorecard\n\nWe will initially utilize an importance scorecard to identify the key factors that facilitate investment in the Industry and Construction sector. Each factor will be assigned a weight based on its significance in influencing investment decisions.\n\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Factors                 | Weightage | Remarks                                                                                                                                   |\n+=========================+===========+===========================================================================================================================================+\n| Labor Policy            | 30        | A critical component in ensuring workforce efficiency, stability, and productivity, essential for sustaining long-term industrial growth. |\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Land Access             | 25        | Vital for industrial expansion and construction projects, especially in rapidly growing urban and industrial zones.                       |\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Entry Costs             | 20        | Key consideration for small-to-medium-scale industrial ventures, influencing the ease of market entry and startup scalability.            |\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Business Support Policy | 15        | Drives investor confidence and facilitates smoother business operations, making it a key driver of economic competitiveness.              |\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n| Transparency            | 10        | Reduces corruption, enhancing long-term industrial growth and foreign investment.                                                         |\n+-------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------+\n\n<br>\n\n## Local Indicator of Spatial Association (LISA)\n\nThe application of Local Indicators of Spatial Association (LISA) in this analysis is intended to investigate the spatial dynamics of the industry and construction sector across multiple years.\n\nBy conducting LISA for each individual year, this analysis seeks to identify local patterns of correlation that reveal significant clusters of high and low industry and construction performance over time.\n\nSuch a year-by-year assessment provides critical insights into the fluctuations of industry and construction metrics across different provinces, allowing for a thorough evaluation of the spatial relationships inherent in the sector.\n\n::: panel-tabset\n## 2012\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2012.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-67-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2012 <- industry_construction_sector %>% \n  filter(year == 2012)\n  \n\nindustry_construction_sector_2012 <- st_as_sf(industry_construction_sector_2012)\nnb <- st_contiguity(industry_construction_sector_2012$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2012 <- industry_construction_sector_2012 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2012 <- industry_construction_sector_2012 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2012.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2012 <- lisa_industry_construction_sector_2012  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2012) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2012) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2012\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2013\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2013.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-71-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2013 <- industry_construction_sector %>% \n  filter(year == 2013)\n  \n\nindustry_construction_sector_2013 <- st_as_sf(industry_construction_sector_2013)\nnb <- st_contiguity(industry_construction_sector_2013$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2013 <- industry_construction_sector_2013 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2013 <- industry_construction_sector_2013 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2013.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2013 <- lisa_industry_construction_sector_2013  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2013) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2013) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2013\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2014\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2014.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-75-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2014 <- industry_construction_sector %>% \n  filter(year == 2014) \n  \n\nindustry_construction_sector_2014 <- st_as_sf(industry_construction_sector_2014)\nnb <- st_contiguity(industry_construction_sector_2014$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2014 <- industry_construction_sector_2014 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2014 <- industry_construction_sector_2014 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2014.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2014 <- lisa_industry_construction_sector_2014  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2014) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2014) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2014\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2015\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2015.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-79-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2015 <- industry_construction_sector %>% \n  filter(year == 2015) \n  \n\nindustry_construction_sector_2015 <- st_as_sf(industry_construction_sector_2015)\nnb <- st_contiguity(industry_construction_sector_2015$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2015 <- industry_construction_sector_2015 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2015 <- industry_construction_sector_2015 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2015.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2015 <- lisa_industry_construction_sector_2015  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2015) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2015) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2015\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2016\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2016.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-83-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2016 <- industry_construction_sector %>% \n  filter(year == 2016) \n  \n\nindustry_construction_sector_2016 <- st_as_sf(industry_construction_sector_2016)\nnb <- st_contiguity(industry_construction_sector_2016$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2016 <- industry_construction_sector_2016 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2016 <- industry_construction_sector_2016 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2016.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2016 <- lisa_industry_construction_sector_2016  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2016) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2016) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2016\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2017.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-87-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2017 <- industry_construction_sector %>% \n  filter(year == 2017) \n  \n\nindustry_construction_sector_2017 <- st_as_sf(industry_construction_sector_2017)\nnb <- st_contiguity(industry_construction_sector_2017$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2017 <- industry_construction_sector_2017 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2017 <- industry_construction_sector_2017 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2017.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2017 <- lisa_industry_construction_sector_2017  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2017) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2017) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2017\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2018\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2018.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-91-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2018 <- industry_construction_sector %>% \n  filter(year == 2018) \n  \n\nindustry_construction_sector_2018 <- st_as_sf(industry_construction_sector_2018)\nnb <- st_contiguity(industry_construction_sector_2018$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2018 <- industry_construction_sector_2018 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2018 <- industry_construction_sector_2018 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2018.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2018 <- lisa_industry_construction_sector_2018  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2018) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2018) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2018\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2019\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2019.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-95-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2019 <- industry_construction_sector %>% \n  filter(year == 2019) \n  \n\nindustry_construction_sector_2019 <- st_as_sf(industry_construction_sector_2019)\nnb <- st_contiguity(industry_construction_sector_2019$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2019 <- industry_construction_sector_2019 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2019 <- industry_construction_sector_2019 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2019.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2019 <- lisa_industry_construction_sector_2019  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2019) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2019) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2019\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2020.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-99-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2020 <- industry_construction_sector %>% \n  filter(year == 2020) \n  \n\nindustry_construction_sector_2020 <- st_as_sf(industry_construction_sector_2020)\nnb <- st_contiguity(industry_construction_sector_2020$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2020 <- industry_construction_sector_2020 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2020 <- industry_construction_sector_2020 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2020.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2020 <- lisa_industry_construction_sector_2020  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2020) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2020) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2020\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2021\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2021.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-103-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2021 <- industry_construction_sector %>% \n  filter(year == 2021) \n  \n\nindustry_construction_sector_2021 <- st_as_sf(industry_construction_sector_2021)\nnb <- st_contiguity(industry_construction_sector_2021$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2021 <- industry_construction_sector_2021 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2021 <- industry_construction_sector_2021 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2021.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2021 <- lisa_industry_construction_sector_2021  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2021) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2021) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2021\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/lisa_map_2022.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-107-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector_2022 <- industry_construction_sector %>% \n  filter(year == 2022) \n  \n\nindustry_construction_sector_2022 <- st_as_sf(industry_construction_sector_2022)\nnb <- st_contiguity(industry_construction_sector_2022$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector_2022 <- industry_construction_sector_2022 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_industry_construction_sector_2022 <- industry_construction_sector_2022 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/lisa_map_2022.png\", width = 1600, height = 1200)\n\nlisa__industry_construction_sector_sig_2022 <- lisa_industry_construction_sector_2022  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_industry_construction_sector_2022) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__industry_construction_sector_sig_2022) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2022\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n:::\n\n<br/>\n\n## Hot Spot & Cold Spot Area Analysis (HCSA)\n\nSubsequent to the LISA analysis, a Hotspot and Coldspot Analysis (HCSA) will be conducted to evaluate the temporal trends in industry and construction performance over the same time frame.\n\nHCSA is instrumental in identifying areas that have exhibited consistent patterns of improvement or decline over the years. Through the assessment of the evolution of hot and cold spots, this analysis will highlight emerging investment opportunities while also identifying regions that require targeted interventions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-111-1.png){width=800}\n:::\n:::\n\n\n::: panel-tabset\n## Computing local Gi\\* statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nindustry_construction_sector <- st_as_sf(industry_construction_sector)\nnb <- st_contiguity(industry_construction_sector$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nindustry_construction_sector <- industry_construction_sector %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n\n\nhcsa <- industry_construction_sector %>% \n  mutate(local_Gi = local_gstar_perm(\n    weighted_score, nb, wts, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi)\n```\n:::\n\n\n## Visualising Hot Spot & Cold Spot\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/hcsa_map.png\", width = 1600, height = 1200)\n\nHCSA_sig <- hcsa  %>%\n  filter(p_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(hcsa) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(HCSA_sig) +\n  tm_fill(\"cluster\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## HCSA Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhcsa_summary <- read_rds(\"data/rds/industry_construction_sector/hcsa_summary.rds\")\n# Show all rows and columns\nprint(hcsa_summary, n = Inf, width = Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 10 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 205950.8 ymin: 933052.3 xmax: 1597017 ymax: 2586945\nProjected CRS: VN-2000 / UTM zone 48N\n# A tibble: 1 × 11\n  mean_gi_star min_gi_star max_gi_star sd_gi_star mean_p_value min_p_value\n         <dbl>       <dbl>       <dbl>      <dbl>        <dbl>       <dbl>\n1       -0.107       -6.70        5.47       2.72        0.262    2.32e-12\n  max_p_value count_hot_spots count_cold_spots count_non_significant\n        <dbl>           <int>            <int>                 <int>\n1       0.998             137              158                   409\n                                                                        geometry\n                                                              <MULTIPOLYGON [m]>\n1 (((481707.8 934784, 481390.2 933367, 480954.2 933052.3, 480280.8 933564.3, 47…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to summarize HCSA values\nsummarize_hcsa <- function(data) {\n  data %>%\n    summarise(\n      mean_gi_star = mean(gi_star, na.rm = TRUE),\n      min_gi_star = min(gi_star, na.rm = TRUE),\n      max_gi_star = max(gi_star, na.rm = TRUE),\n      sd_gi_star = sd(gi_star, na.rm = TRUE),\n      mean_p_value = mean(p_value, na.rm = TRUE),\n      min_p_value = min(p_value, na.rm = TRUE),\n      max_p_value = max(p_value, na.rm = TRUE),\n      count_hot_spots = sum(gi_star > 0 & p_value < 0.05),\n      count_cold_spots = sum(gi_star < 0 & p_value < 0.05),\n      count_non_significant = sum(p_value >= 0.05),\n      geometry = st_union(geometry)  # Combine geometries\n    )\n}\n\n\nhcsa_summary <- summarize_hcsa(hcsa)\nwrite_rds(hcsa_summary, \"data/rds/industry_construction_sector/hcsa_summary.rds\")\n```\n:::\n\n:::\n\n::: callout-note\n## HCSA Summary Interpretation\n\n### **Mean `gi_star`:**\n\n-   \n\n### **Standard Deviation (`sd_gi_star`):**\n\n-   \n\n### **Mean `p_value`:**\n\n-   \n:::\n\n<br/>\n\n## Mann-Kendall Test for trend\n\nThis will evaluate the competitiveness trends of the industry and construction sectors across each province over multiple years.\n\nThe goal is to identify provinces that are becoming more competitive as well as those that are experiencing a decline in competitiveness.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrend_results <- read_rds(\"data/rds/industry_construction_sector/trend_results.rds\")\n```\n:::\n\n\n::: panel-tabset\n## Increasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasing_trends <- trend_results %>%\n  filter(trend_status == \"Increasing\") %>%\n  pull(province_en)\n\n# Check if increasing_trends is null or empty and set a default message\nif (is.null(increasing_trends) || length(increasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(increasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBRVT, Bac Giang, Bac Ninh, Binh Duong, Ca Mau, Can Tho, Dak Nong, Ha Noi, Hai Duong, Hung Yen, Khanh Hoa, Lai Chau, Lam Dong, Lang Son, Phu Tho, Quang Ngai, Quang Ninh, Tien Giang \n```\n\n\n:::\n:::\n\n\n## Decreasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndecreasing_trends <- trend_results %>%\n  filter(trend_status == \"Decreasing\") %>%\n  pull(province_en)\n\n# Check if decreasing_trends is null or empty and set a default message\nif (is.null(decreasing_trends) || length(decreasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(decreasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKien Giang \n```\n\n\n:::\n:::\n\n\n## Stable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstable_trends <- trend_results %>%\n  filter(trend_status == \"Stable\") %>%\n  pull(province_en)\n\n# Check if stable_trends is null or empty and set a default message\nif (is.null(stable_trends) || length(stable_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(stable_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAn Giang, Bac Kan, Bac Lieu, Ben Tre, Binh Dinh, Binh Phuoc, Binh Thuan, Cao Bang, Da Nang, Dak Lak, Dien Bien, Dong Nai, Dong Thap, Gia Lai, HCMC, Ha Giang, Ha Nam, Ha Tinh, Hai Phong, Hau Giang, Hoa Binh, Kon Tum, Lao Cai, Long An, Nam Dinh, Nghe An, Ninh Binh, Ninh Thuan, Phu Yen, Quang Binh, Quang Nam, Quang Tri, Soc Trang, Son La, TT-Hue, Tay Ninh, Thai Binh, Thai Nguyen, Thanh Hoa, Tra Vinh, Tuyen Quang, Vinh Long, Vinh Phuc, Yen Bai \n```\n\n\n:::\n:::\n\n:::\n\n::: callout-note\nTBD\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Apply Mann-Kendall Test for each province\ntrend_results <- industry_construction_sector %>%\n  group_by(province_en) %>%\n  summarise(\n    weighted_score = list(weighted_score),         \n    trend = MannKendall(unlist(weighted_score))$tau,  # Tau value indicates trend direction\n    p_value = MannKendall(unlist(weighted_score))$sl,   # p-value for significance\n  )\n\n# Classify trends based on the Mann-Kendall results\ntrend_results <- trend_results %>%\n  mutate(trend_status = case_when(\n    p_value < 0.05 & trend > 0 ~ \"Increasing\",\n    p_value < 0.05 & trend < 0 ~ \"Decreasing\",\n    p_value >= 0.05 ~ \"Stable\",\n    TRUE ~ \"No sufficient data\"\n  ))\n\nwrite_rds(trend_results, \"data/rds/industry_construction_sector/trend_results.rds\")\n```\n:::\n\n\n<br/>\n\n## Dendrogram Analysis to Identify Competitiveness Clusters\n\nIt visually clusters provinces with similar trends in weighted scores across years. By grouping provinces based on competitiveness factors, it highlights regions with shared strengths or challenges, allowing stakeholders to identify investment-friendly clusters or regions needing targeted support.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naverage_scores <- industry_construction_sector %>%\n  group_by(province_en) %>%\n  summarise(avg_weighted_score = mean(weighted_score, na.rm = TRUE)) %>%\n  ungroup()\n\n# Convert province_en to row names\naverage_scores_rownames <- average_scores %>%\n  column_to_rownames(var = \"province_en\")\n\nproxmat <- dist(average_scores_rownames, method = 'euclidean')\nhclust_ward <- hclust(proxmat, method = 'ward.D')\ngroups <- as.factor(cutree(hclust_ward, k=6))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(hclust_ward, cex=0.6)\nrect.hclust(hclust_ward, k=6, border=2.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-122-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n<br/>\n\n## Forecasting Near-Term Provincial Competitiveness\n\nThis foresight enables investors and decision-makers to proactively anticipate challenges and seize opportunities, allowing them to respond swiftly and effectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/industry_construction_sector/prediction_hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-124-1.png){width=800}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narima_forecasts <- list()\n\nfor (province in unique(industry_construction_sector$province_en)) {\n  province_data <- industry_construction_sector %>%\n    filter(province_en == province) %>%\n    arrange(year)\n  \n  # Create time series object for weighted score\n  ts_data <- ts(province_data$weighted_score, start = min(province_data$year), frequency = 1)\n  \n  # Fit ARIMA model\n  fit <- auto.arima(ts_data)\n  \n  # Forecast for the next 5 years (2023 to 2027)\n  forecasted_values <- forecast(fit, h = 5)\n  \n  # Store forecast results for each year\n  arima_forecasts[[province]] <- data.frame(\n    province_en = province,\n    year = 2023:2027,\n    predicted_weighted_score = as.numeric(forecasted_values$mean)\n  )\n}\n\n# Combine forecast results for all provinces\nfuture_predictions <- bind_rows(arima_forecasts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set thresholds for hot and cold spots\nhot_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.75)\ncold_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.25)\n\n# Classify hot/cold spots based on predicted cases for each year\nfuture_predictions <- future_predictions %>%\n  mutate(hot_cold_label = case_when(\n    predicted_weighted_score > hot_spot_threshold ~ \"Hot Spot\",\n    predicted_weighted_score < cold_spot_threshold ~ \"Cold Spot\",\n    TRUE ~ \"Neutral\"\n  ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/industry_construction_sector/prediction_hcsa_map.png\", width = 1600, height = 1200)\n\n# Merge predictions with spatial data\nfuture_spatial <- provincial_boundaries %>%\n  left_join(future_predictions, by = \"province_en\")\n\n\ntm_shape(future_spatial) +\n  tm_polygons(\"hot_cold_label\", palette = c(\"blue\", \"red\", \"gray\")) +\n  tm_borders() +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n<br/><br/>\n\n# **6.0 Provinces suitable for Services sector**\n\n## Importance Scorecard\n\nWe will initially utilize an importance scorecard to identify the key factors that facilitate investment in the Services sector. Each factor will be assigned a weight based on its significance in influencing investment decisions.\n\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n| Factors                 | Weightage | Remarks                                                                                                                  |\n+=========================+===========+==========================================================================================================================+\n| Transparency            | 30        | Essential for building trust with consumers and investors, transparency reduces corruption and enhances service quality. |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n| Business Support Policy | 25        | Vital for creating a conducive environment for service providers and fostering innovation in the sector.                 |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n| Labor Policy            | 20        | Important for ensuring a skilled and adaptable workforce, particularly in sectors like IT, tourism, and finance.         |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n| Entry Costs             | 15        | Influences the ability of new businesses to enter the market, particularly in competitive service industries.            |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n| Proactivity             | 10        | A proactive approach by the government in supporting the services sector can lead to more robust growth and innovation.  |\n+-------------------------+-----------+--------------------------------------------------------------------------------------------------------------------------+\n\n## Local Indicator of Spatial Association (LISA)\n\nThe application of Local Indicators of Spatial Association (LISA) in this analysis is intended to investigate the spatial dynamics of the services sector across multiple years.\n\nBy conducting LISA for each individual year, this analysis seeks to identify local patterns of correlation that reveal significant clusters of high and low services performance over time.\n\nSuch a year-by-year assessment provides critical insights into the fluctuations of services metrics across different provinces, allowing for a thorough evaluation of the spatial relationships inherent in the sector.\n\n::: panel-tabset\n## 2012\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2012.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-128-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2012 <- services_sector %>% \n  filter(year == 2012)\n  \n\nservices_sector_2012 <- st_as_sf(services_sector_2012)\nnb <- st_contiguity(services_sector_2012$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2012 <- services_sector_2012 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2012 <- services_sector_2012 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2012.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2012 <- lisa_services_sector_2012  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2012) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2012) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2012\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2013\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2013.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-132-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2013 <- services_sector %>% \n  filter(year == 2013)\n  \n\nservices_sector_2013 <- st_as_sf(services_sector_2013)\nnb <- st_contiguity(services_sector_2013$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2013 <- services_sector_2013 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2013 <- services_sector_2013 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2013.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2013 <- lisa_services_sector_2013  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2013) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2013) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2013\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2014\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2014.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-136-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2014 <- services_sector %>% \n  filter(year == 2014) \n  \n\nservices_sector_2014 <- st_as_sf(services_sector_2014)\nnb <- st_contiguity(services_sector_2014$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2014 <- services_sector_2014 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2014 <- services_sector_2014 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2014.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2014 <- lisa_services_sector_2014  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2014) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2014) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2014\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2015\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2015.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-140-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2015 <- services_sector %>% \n  filter(year == 2015) \n  \n\nservices_sector_2015 <- st_as_sf(services_sector_2015)\nnb <- st_contiguity(services_sector_2015$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2015 <- services_sector_2015 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2015 <- services_sector_2015 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2015.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2015 <- lisa_services_sector_2015  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2015) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2015) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2015\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2016\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2016.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-144-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2016 <- services_sector %>% \n  filter(year == 2016) \n  \n\nservices_sector_2016 <- st_as_sf(services_sector_2016)\nnb <- st_contiguity(services_sector_2016$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2016 <- services_sector_2016 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2016 <- services_sector_2016 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2016.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2016 <- lisa_services_sector_2016  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2016) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2016) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2016\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2017\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2017.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-148-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2017 <- services_sector %>% \n  filter(year == 2017) \n  \n\nservices_sector_2017 <- st_as_sf(services_sector_2017)\nnb <- st_contiguity(services_sector_2017$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2017 <- services_sector_2017 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2017 <- services_sector_2017 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2017.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2017 <- lisa_services_sector_2017  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2017) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2017) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2017\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2018\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2018.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-152-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2018 <- services_sector %>% \n  filter(year == 2018) \n  \n\nservices_sector_2018 <- st_as_sf(services_sector_2018)\nnb <- st_contiguity(services_sector_2018$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2018 <- services_sector_2018 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2018 <- services_sector_2018 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2018.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2018 <- lisa_services_sector_2018  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2018) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2018) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2018\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2019\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2019.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-156-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2019 <- services_sector %>% \n  filter(year == 2019) \n  \n\nservices_sector_2019 <- st_as_sf(services_sector_2019)\nnb <- st_contiguity(services_sector_2019$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2019 <- services_sector_2019 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2019 <- services_sector_2019 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2019.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2019 <- lisa_services_sector_2019  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2019) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2019) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2019\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2020.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-160-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2020 <- services_sector %>% \n  filter(year == 2020) \n  \n\nservices_sector_2020 <- st_as_sf(services_sector_2020)\nnb <- st_contiguity(services_sector_2020$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2020 <- services_sector_2020 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2020 <- services_sector_2020 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2020.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2020 <- lisa_services_sector_2020  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2020) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2020) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2020\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2021\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2021.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-164-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2021 <- services_sector %>% \n  filter(year == 2021) \n  \n\nservices_sector_2021 <- st_as_sf(services_sector_2021)\nnb <- st_contiguity(services_sector_2021$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2021 <- services_sector_2021 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2021 <- services_sector_2021 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2021.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2021 <- lisa_services_sector_2021  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2021) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2021) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2021\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## 2022\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/lisa_map_2022.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-168-1.png){width=800}\n:::\n:::\n\n\n### **Deriving Queen’s Contiguity weights: sfdep methods**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector_2022 <- services_sector %>% \n  filter(year == 2022) \n  \n\nservices_sector_2022 <- st_as_sf(services_sector_2022)\nnb <- st_contiguity(services_sector_2022$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector_2022 <- services_sector_2022 %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n```\n:::\n\n\n### **Computing Local Moran’s I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_services_sector_2022 <- services_sector_2022 %>% \n  mutate(local_moran = local_moran(\n    weighted_score, nb, wt, nsim = 99, zero.policy = TRUE),\n    .before = 1) %>% \n  unnest(local_moran)\n```\n:::\n\n\n### LISA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/lisa_map_2022.png\", width = 1600, height = 1200)\n\nlisa__services_sector_sig_2022 <- lisa_services_sector_2022  %>%\n  filter(p_ii_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(lisa_services_sector_2022) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa__services_sector_sig_2022) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Map 2022\",   \n            main.title.size = 2.5,              \n            legend.text.size = 2.0,           \n            legend.title.size = 2.7,         \n            legend.position = c(\"right\", \"bottom\"), \n            frame = TRUE)  # Add a frame around the map\n\n# Close the graphic device\ndev.off()\n```\n:::\n\n:::\n\n<br/>\n\n## Hot Spot & Cold Spot Area Analysis (HCSA)\n\nSubsequent to the LISA analysis, a Hotspot and Coldspot Analysis (HCSA) will be conducted to evaluate the temporal trends in industry and construction performance over the same time frame.\n\nHCSA is instrumental in identifying areas that have exhibited consistent patterns of improvement or decline over the years. Through the assessment of the evolution of hot and cold spots, this analysis will highlight emerging investment opportunities while also identifying regions that require targeted interventions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-172-1.png){width=800}\n:::\n:::\n\n\n::: panel-tabset\n## Computing local Gi\\* statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nservices_sector <- st_as_sf(services_sector)\nnb <- st_contiguity(services_sector$geometry)\nwt <- st_weights(nb, style = \"W\", allow_zero = TRUE)\n\nservices_sector <- services_sector %>% \n  mutate(\n    nb = nb,\n    wt = wt,\n    .before = 1\n  )\n\n\nhcsa <- services_sector %>% \n  mutate(local_Gi = local_gstar_perm(\n    weighted_score, nb, wts, nsim = 99),\n         .before = 1) %>%\n  unnest(local_Gi)\n```\n:::\n\n\n## Visualising Hot Spot & Cold Spot\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/hcsa_map.png\", width = 1600, height = 1200)\n\nHCSA_sig <- hcsa  %>%\n  filter(p_sim < 0.05)\ntmap_mode(\"plot\")\n\ntm_shape(hcsa) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(HCSA_sig) +\n  tm_fill(\"cluster\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n## HCSA Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhcsa_summary <- read_rds(\"data/rds/services_sector/hcsa_summary.rds\")\n# Show all rows and columns\nprint(hcsa_summary, n = Inf, width = Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 10 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 205950.8 ymin: 933052.3 xmax: 1597017 ymax: 2586945\nProjected CRS: VN-2000 / UTM zone 48N\n# A tibble: 1 × 11\n  mean_gi_star min_gi_star max_gi_star sd_gi_star mean_p_value min_p_value\n         <dbl>       <dbl>       <dbl>      <dbl>        <dbl>       <dbl>\n1      -0.0505       -4.63        4.84       2.22        0.246 0.000000204\n  max_p_value count_hot_spots count_cold_spots count_non_significant\n        <dbl>           <int>            <int>                 <int>\n1       0.997             143              152                   409\n                                                                        geometry\n                                                              <MULTIPOLYGON [m]>\n1 (((481707.8 934784, 481390.2 933367, 480954.2 933052.3, 480280.8 933564.3, 47…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to summarize HCSA values\nsummarize_hcsa <- function(data) {\n  data %>%\n    summarise(\n      mean_gi_star = mean(gi_star, na.rm = TRUE),\n      min_gi_star = min(gi_star, na.rm = TRUE),\n      max_gi_star = max(gi_star, na.rm = TRUE),\n      sd_gi_star = sd(gi_star, na.rm = TRUE),\n      mean_p_value = mean(p_value, na.rm = TRUE),\n      min_p_value = min(p_value, na.rm = TRUE),\n      max_p_value = max(p_value, na.rm = TRUE),\n      count_hot_spots = sum(gi_star > 0 & p_value < 0.05),\n      count_cold_spots = sum(gi_star < 0 & p_value < 0.05),\n      count_non_significant = sum(p_value >= 0.05),\n      geometry = st_union(geometry)  # Combine geometries\n    )\n}\n\n\nhcsa_summary <- summarize_hcsa(hcsa)\nwrite_rds(hcsa_summary, \"data/rds/services_sector/hcsa_summary.rds\")\n```\n:::\n\n:::\n\n::: callout-note\n## HCSA Summary Interpretation\n\n### **Mean `gi_star`:**\n\n-   \n\n### **Standard Deviation (`sd_gi_star`):**\n\n-   \n\n### **Mean `p_value`:**\n\n-   \n:::\n\n<br/>\n\n## Mann-Kendall Test for trend\n\nThis will evaluate the competitiveness trends of the industry and construction sectors across each province over multiple years.\n\nThe goal is to identify provinces that are becoming more competitive as well as those that are experiencing a decline in competitiveness.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrend_results <- read_rds(\"data/rds/services_sector/trend_results.rds\")\n```\n:::\n\n\n::: panel-tabset\n## Increasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincreasing_trends <- trend_results %>%\n  filter(trend_status == \"Increasing\") %>%\n  pull(province_en)\n\n# Check if increasing_trends is null or empty and set a default message\nif (is.null(increasing_trends) || length(increasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(increasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBRVT, Bac Giang, Bac Kan, Bac Ninh, Binh Duong, Binh Phuoc, Binh Thuan, Ca Mau, Can Tho, Dak Nong, Gia Lai, Ha Nam, Ha Noi, Hai Duong, Hai Phong, Kon Tum, Lai Chau, Lang Son, Ninh Thuan, Phu Tho, Phu Yen, Quang Binh, Quang Ninh, Quang Tri, Soc Trang, Tien Giang, Tuyen Quang \n```\n\n\n:::\n:::\n\n\n## Decreasing Trends\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndecreasing_trends <- trend_results %>%\n  filter(trend_status == \"Decreasing\") %>%\n  pull(province_en)\n\n# Check if decreasing_trends is null or empty and set a default message\nif (is.null(decreasing_trends) || length(decreasing_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(decreasing_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNIL \n```\n\n\n:::\n:::\n\n\n## Stable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstable_trends <- trend_results %>%\n  filter(trend_status == \"Stable\") %>%\n  pull(province_en)\n\n# Check if stable_trends is null or empty and set a default message\nif (is.null(stable_trends) || length(stable_trends) == 0) {\n  result <- \"NIL\"\n} else {\n  result <- paste(stable_trends, collapse = \", \")\n}\n\ncat(result, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAn Giang, Bac Lieu, Ben Tre, Binh Dinh, Cao Bang, Da Nang, Dak Lak, Dien Bien, Dong Nai, Dong Thap, HCMC, Ha Giang, Ha Tinh, Hau Giang, Hoa Binh, Hung Yen, Khanh Hoa, Kien Giang, Lam Dong, Lao Cai, Long An, Nam Dinh, Nghe An, Ninh Binh, Quang Nam, Quang Ngai, Son La, TT-Hue, Tay Ninh, Thai Binh, Thai Nguyen, Thanh Hoa, Tra Vinh, Vinh Long, Vinh Phuc, Yen Bai \n```\n\n\n:::\n:::\n\n:::\n\n::: callout-note\nTBD\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Apply Mann-Kendall Test for each province\ntrend_results <- services_sector %>%\n  group_by(province_en) %>%\n  summarise(\n    weighted_score = list(weighted_score),         \n    trend = MannKendall(unlist(weighted_score))$tau,  # Tau value indicates trend direction\n    p_value = MannKendall(unlist(weighted_score))$sl,   # p-value for significance\n  )\n\n# Classify trends based on the Mann-Kendall results\ntrend_results <- trend_results %>%\n  mutate(trend_status = case_when(\n    p_value < 0.05 & trend > 0 ~ \"Increasing\",\n    p_value < 0.05 & trend < 0 ~ \"Decreasing\",\n    p_value >= 0.05 ~ \"Stable\",\n    TRUE ~ \"No sufficient data\"\n  ))\n\nwrite_rds(trend_results, \"data/rds/services_sector/trend_results.rds\")\n```\n:::\n\n\n<br/>\n\n## Dendrogram Analysis to Identify Competitiveness Clusters\n\nIt visually clusters provinces with similar trends in weighted scores across years. By grouping provinces based on competitiveness factors, it highlights regions with shared strengths or challenges, allowing stakeholders to identify investment-friendly clusters or regions needing targeted support.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naverage_scores <- services_sector %>%\n  group_by(province_en) %>%\n  summarise(avg_weighted_score = mean(weighted_score, na.rm = TRUE)) %>%\n  ungroup()\n\n# Convert province_en to row names\naverage_scores_rownames <- average_scores %>%\n  column_to_rownames(var = \"province_en\")\n\nproxmat <- dist(average_scores_rownames, method = 'euclidean')\nhclust_ward <- hclust(proxmat, method = 'ward.D')\ngroups <- as.factor(cutree(hclust_ward, k=6))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(hclust_ward, cex=0.6)\nrect.hclust(hclust_ward, k=6, border=2.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-183-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n<br/>\n\n## Forecasting Near-Term Provincial Competitiveness\n\nThis foresight enables investors and decision-makers to proactively anticipate challenges and seize opportunities, allowing them to respond swiftly and effectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimage_read(\"data/rds/services_sector/prediction_hcsa_map.png\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-185-1.png){width=800}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narima_forecasts <- list()\n\nfor (province in unique(services_sector$province_en)) {\n  province_data <- services_sector %>%\n    filter(province_en == province) %>%\n    arrange(year)\n  \n  # Create time series object for weighted score\n  ts_data <- ts(province_data$weighted_score, start = min(province_data$year), frequency = 1)\n  \n  # Fit ARIMA model\n  fit <- auto.arima(ts_data)\n  \n  # Forecast for the next 5 years (2023 to 2027)\n  forecasted_values <- forecast(fit, h = 5)\n  \n  # Store forecast results for each year\n  arima_forecasts[[province]] <- data.frame(\n    province_en = province,\n    year = 2023:2027,\n    predicted_weighted_score = as.numeric(forecasted_values$mean)\n  )\n}\n\n# Combine forecast results for all provinces\nfuture_predictions <- bind_rows(arima_forecasts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set thresholds for hot and cold spots\nhot_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.75)\ncold_spot_threshold <- quantile(future_predictions$predicted_weighted_score, 0.25)\n\n# Classify hot/cold spots based on predicted cases for each year\nfuture_predictions <- future_predictions %>%\n  mutate(hot_cold_label = case_when(\n    predicted_weighted_score > hot_spot_threshold ~ \"Hot Spot\",\n    predicted_weighted_score < cold_spot_threshold ~ \"Cold Spot\",\n    TRUE ~ \"Neutral\"\n  ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"data/rds/services_sector/prediction_hcsa_map.png\", width = 1600, height = 1200)\n\n# Merge predictions with spatial data\nfuture_spatial <- provincial_boundaries %>%\n  left_join(future_predictions, by = \"province_en\")\n\n\ntm_shape(future_spatial) +\n  tm_polygons(\"hot_cold_label\", palette = c(\"blue\", \"red\", \"gray\")) +\n  tm_borders() +\n  tm_layout(main.title = \"HCSA\",\n            main.title.size = 2.5,   \n            legend.text.size = 2.0, \n            legend.position = c(\"right\", \"bottom\"), \n            legend.title.size = 2.7) \n\n# Close the graphic device\ndev.off()\n```\n:::\n\n\n<br/><br/>\n\n# **Reference**\n\n## Key factors in Agriculture, forestry and fishing\n\n[Open Development Vietnam -Agriculture and Fishing](https://vietnam.opendevelopmentmekong.net/topics/agriculture-and-fishing/)\n\n[FAO.org -Sustainable Food and Agriculture](https://www.fao.org/sustainability/news/detail/en/c/1275817/)\n\n## Key factors in Industry and Construction\n\n[Savills -Industrial Property](https://industrial.savills.com.vn/2024/01/investing-in-vietnam/)\n\n[Dezan Shira and Associates Vietnam Briefing](https://www.vietnam-briefing.com/news/northern-vietnam-industrial-parks.html/)\n\n## Others\n\n[5 year Socio-Economic Development Plan](https://pubdocs.worldbank.org/en/839361477533488479/Vietnam-SEDP-2016-2020.pdf)\n\n[Main Industries in Vietnam](https://vietnamcredit.com.vn/news/the-main-industries-in-vietnam_14413)\n",
    "supporting": [
      "Take-home_Ex03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}